# ============================================================
# CALZADO J&R — nginx.conf para producción (React SPA)
# ============================================================
# ¿Qué?    Configuración de nginx para servir una SPA (Single Page App).
# ¿Para?   React Router maneja las rutas en el navegador (client-side).
#           Sin esta config, actualizar /dashboard daría 404 porque
#           nginx buscaría un archivo llamado "dashboard" que no existe.
# ¿Impacto? try_files $uri $uri/ /index.html; es la clave:
#           busca el archivo → busca el directorio → cae en index.html,
#           que deja que React Router tome el control.
# ============================================================
server {
    listen 80;
    server_name _;

    # Raíz donde están los archivos compilados por Vite
    root /usr/share/nginx/html;
    index index.html;

    # ────────────────────────────
    # Caché agresiva para assets con hash (JS, CSS, imágenes)
    # ¿Por qué? Vite genera nombres con hash (main.a1b2c3.js).
    # Si el contenido cambia, el hash cambia → nueva URL → no hay
    # riesgo de servir una versión vieja. Cache 1 año = máximo rendimiento.
    # ────────────────────────────
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # ────────────────────────────
    # Todas las demás rutas → index.html (React Router las maneja)
    # ────────────────────────────
    location / {
        try_files $uri $uri/ /index.html;
    }

    # ────────────────────────────
    # Ocultar la versión de nginx en respuestas (seguridad básica)
    # ────────────────────────────
    server_tokens off;
}
